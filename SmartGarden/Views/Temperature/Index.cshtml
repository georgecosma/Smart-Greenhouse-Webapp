@using SmartGarden.Models.DbModels
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";

    List<TemperatureDataViewModel> temperatureValuesList = (List<TemperatureDataViewModel>)ViewBag.temperatureValuesList;
}

<div class="block-header">
    <h2>TEMPERATURĂ</h2>
</div>
<br />

<div class="row">
    @*<div class="col-md-4">*@
    <div class="col-md-offset-4 col-md-4">
        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4" style="width:100%;">
            <div class="card">
                <div class="header bg-red">
                    <div class="row">
                        <div class="col-md-1">
                            <center><i class="fa fa-thermometer-half fa-2x" aria-hidden="true"></i></center>
                        </div>
                        <div class="col-md-11">
                            <center><div class="text" style="font-size:large">INFORMAȚII LIVE</div></center>
                        </div>
                    </div>
                </div>
                <div class="body">
                    <div class="text">Situația în timp real privind temperatura.</div>
                    <hr />
                    <ul class="dashboard-stat-list">
                        <li>
                            <b>TEMPERATURA<span class="pull-right">VALOARE</span></b>
                        </li>
                        <li>
                            INTERIOARĂ
                            <span class="pull-right"><b id="temperatureValueDiv">@ViewBag.temperatureValue</b> <b>&#8451;</b></span>
                        </li>
                        @*
                        <li>
                            EXTERIOARĂ
                            <span class="pull-right"><b>28.00</b> <b>&#8451;</b></span>
                        </li>
                            *@
                    </ul>
                </div>
            </div>
        </div>
    </div>
    @*
    <div class="col-md-8">
        <div class="row clearfix">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="card">
                    <div class="header">
                        <h2>REAL-TIME CHART</h2>
                        <div class="pull-right">
                            <div class="switch panel-switch-btn">
                                <span class="m-r-10 font-12">REAL TIME</span>
                                <label>OFF<input type="checkbox" id="realtime" checked><span class="lever switch-col-cyan"></span>ON</label>
                            </div>
                        </div>
                        <ul class="header-dropdown m-r--5">
                            <li class="dropdown">
                                <a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                                    <i class="material-icons">more_vert</i>
                                </a>
                                <ul class="dropdown-menu pull-right">
                                    <li><a href="javascript:void(0);">Action</a></li>
                                    <li><a href="javascript:void(0);">Another action</a></li>
                                    <li><a href="javascript:void(0);">Something else here</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="body">
                        <div id="real_time_chart" class="flot-chart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    *@
</div>



<div class="row">
    @*<div class="col-md-6">*@
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="card">
                <div class="header">
                    <h2>
                        DATE TEMPERATURĂ - INTERIOARĂ
                        <small>Tabelul conține înregistrări ale temperaturii interioare.</small><br />
                    </h2>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th style="text-align:center;">Data</th>
                                <th style="text-align:center;">Valoare</th>
                                <th style="text-align:center;">Situație</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            @foreach(var temp in temperatureValuesList)
                            {
                                <tr style="text-align:center;">
                                    <td>@temp.RegistrationDate</td>
                                    <td>@temp.Value</td>
                                    @if (Decimal.Parse(temp.Value) > 40)
                                    {
                                        <td><span class="label label-danger">temperatură critică</span></td>
                                    }
                                    else if (Decimal.Parse(temp.Value) > 32 && Decimal.Parse(temp.Value) <= 40)
                                    {
                                        <td><span class="label label-warning">temperatură ridicată</span></td>
                                    }
                                    else if (Decimal.Parse(temp.Value) <= 32)
                                    {
                                        <td><span class="label label-success">temperatură normală</span></td>
                                    }
                                </tr>
                            }
                            @*
                            <tr style="text-align:center;">
                                <td>12/5/2017</td>
                                <td>30.00</td>
                                <td><span class="label label-success">temperatură normală</span></td>
                            </tr>
                            <tr style="text-align:center;">
                                <td>13/5/2017</td>
                                <td>3800</td>
                                <td><span class="label label-warning">temperatură ridicată</span></td>
                            </tr>
                            <tr style="text-align:center;">
                                <td>14/5/2017</td>
                                <td>50.00</td>
                                <td><span class="label label-danger">temperatură critică</span></td>
                            </tr>
                            <tr style="text-align:center;">
                                <td>12/5/2017</td>
                                <td>30.00</td>
                                <td><span class="label label-success">temperatură normală</span></td>
                            </tr>
                            <tr style="text-align:center;">
                                <td>12/5/2017</td>
                                <td>28.00</td>
                                <td><span class="label label-success">temperatură normală</span></td>
                            </tr>
                            <tr style="text-align:center;">
                                <td>13/5/2017</td>
                                <td>40.00</td>
                                <td><span class="label label-warning">temperatură ridicată</span></td>
                            </tr>
                                *@
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    @*</div>*@
    @*
    <div class="col-md-6">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="card">
                <div class="header">
                    <h2>
                        DATE TEMPERATURĂ - EXTERIOARĂ
                        <small>Tabelul conține înregistrări ale temperaturii exterioare.</small><br />
                    </h2>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th style="text-align:center;">Data</th>
                                <th style="text-align:center;">Valoare</th>
                                <th style="text-align:center;">Situație</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="text-align:center;">
                                <td>12/5/2017</td>
                                <td>30.00</td>
                                <td><span class="label label-success">temperatură normală</span></td>
                            </tr>
                            <tr style="text-align:center;">
                                <td>13/5/2017</td>
                                <td>3800</td>
                                <td><span class="label label-warning">temperatură ridicată</span></td>
                            </tr>
                            <tr style="text-align:center;">
                                <td>14/5/2017</td>
                                <td>50.00</td>
                                <td><span class="label label-danger">temperatură critică</span></td>
                            </tr>
                            <tr style="text-align:center;">
                                <td>12/5/2017</td>
                                <td>30.00</td>
                                <td><span class="label label-success">temperatură normală</span></td>
                            </tr>
                            <tr style="text-align:center;">
                                <td>12/5/2017</td>
                                <td>28.00</td>
                                <td><span class="label label-success">temperatură normală</span></td>
                            </tr>
                            <tr style="text-align:center;">
                                <td>13/5/2017</td>
                                <td>40.00</td>
                                <td><span class="label label-warning">temperatură ridicată</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
        *@
</div>

<script type="text/javascript">


        function sendRequest() {
            $.ajax({
                url: '/Temperature/updateValues',
                type: 'POST',
                dataType: 'json',
                success: function (response) {
                    document.getElementById("temperatureValueDiv").innerHTML = response.temperatureValue;
                    document.getElementById("tableBody").innerHTML = "";
                    var rows = '';

                    $.each(response.temperatureValuesList, function (index, item) {
                        rows += '<tr style="text-align:center;"><td>' + item.RegistrationDate + '</td><td>' + item.Value + '</td>';
                        var _tempVal = parseFloat(item.Value);

                        if (_tempVal > 40) {
                            rows += '<td><span class="label label-danger">temperatură critică</span></td>';
                        } else if (_tempVal > 32 && _tempVal <= 40) {
                            rows += '<td><span class="label label-warning">temperatură ridicată</span></td>';
                        } else if (_tempVal <= 32) {
                            rows += '<td><span class="label label-success">temperatură normală</span></td>';
                        }

                        rows += '</tr>';
                    });
                    $('#tableBody').html(rows);
                  },
                complete: function () {
                    // Schedule the next request when the current one's complete
                     // The interval set to 5 seconds
                }
            });
        };

      setInterval(sendRequest, 5000);

</script>