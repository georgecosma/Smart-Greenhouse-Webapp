@using SmartGarden.Models.DbModels
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";

    List<SoilMoistureDataViewModel> sm1ValuesList = (List<SoilMoistureDataViewModel>)ViewBag.sm1ValuesList;
    List<SoilMoistureDataViewModel> sm2ValuesList = (List<SoilMoistureDataViewModel>)ViewBag.sm2ValuesList;
    List<SoilMoistureDataViewModel> sm3ValuesList = (List<SoilMoistureDataViewModel>)ViewBag.sm3ValuesList;
}


<div class="block-header">
    <h2>UMIDITATE</h2>
</div>
<br />

<div class="row">
    @*<div class="col-md-4">*@
    <div class="col-md-offset-4 col-md-4">
        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4" style="width:100%;">
            <div class="card" style="min-height:320px;">
                <div class="header bg-blue">
                    <div class="row">
                        <div class="col-md-1">
                            <center><i class="fa fa-tint fa-2x" aria-hidden="true"></i></center>
                        </div>
                        <div class="col-md-11">
                            <center><div class="text" style="font-size:large">UMIDITATEA LIVE</div></center>
                        </div>
                    </div>
                </div>
                <div class="body">
                    <div class="text">Situația în timp real privind umiditatea solului.</div>
                    <hr />
                    <ul class="dashboard-stat-list">
                        <li>
                            <b>UMIDITATE<span class="pull-right">VALOARE</span></b>
                        </li>
                        <li>
                            LINIA 1
                            <span class="pull-right"><b id="soilMoisture1Div">@ViewBag.soilMoisture1</b>%<b></b></span>
                        </li>
                        <li>
                            LINIA 2
                            <span class="pull-right"><b id="soilMoisture2Div">@ViewBag.soilMoisture2</b>%<b></b></span>
                        </li>
                        <li>
                            LINIA 3
                            <span class="pull-right"><b id="soilMoisture3Div">@ViewBag.soilMoisture3</b>%<b></b></span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    @*
    <div class="col-md-8">
        <div class="row clearfix">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="card">
                    <div class="header">
                        <h2>REAL-TIME CHART</h2>
                        <div class="pull-right">
                            <div class="switch panel-switch-btn">
                                <span class="m-r-10 font-12">REAL TIME</span>
                                <label>OFF<input type="checkbox" id="realtime" checked><span class="lever switch-col-cyan"></span>ON</label>
                            </div>
                        </div>
                        <ul class="header-dropdown m-r--5">
                            <li class="dropdown">
                                <a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                                    <i class="material-icons">more_vert</i>
                                </a>
                                <ul class="dropdown-menu pull-right">
                                    <li><a href="javascript:void(0);">Action</a></li>
                                    <li><a href="javascript:void(0);">Another action</a></li>
                                    <li><a href="javascript:void(0);">Something else here</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="body">
                        <div id="real_time_chart" class="flot-chart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
        *@
</div>



    <div class="col-md-4">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="card">
                <div class="header">
                    <h2>
                        DATE UMIDITATE - LINIA 1
                        <small>Tabelul conține înregistrări umidității solului de pe prima linie de irigație.</small><br />
                    </h2>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th style="text-align:center;">Data</th>
                                <th style="text-align:center;">Valoare</th>
                                <th style="text-align:center;">Situație</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody1">
                            @foreach (var temp in sm1ValuesList)
                            {
                                <tr style="text-align:center;">
                                    <td>@temp.RegistrationDate</td>
                                    <td>@temp.Value %</td>
                                    @if (Decimal.Parse(temp.Value) > 85)
                                    {
                                        <td><span class="label label-danger">umiditate ridicată</span></td>
                                    }
                                    else if (Decimal.Parse(temp.Value) > 35 && Decimal.Parse(temp.Value) <= 85)
                                    {
                                        <td><span class="label label-warning">umiditate normală</span></td>
                                    }
                                    else if (Decimal.Parse(temp.Value) <= 35)
                                    {
                                        <td><span class="label label-success">umiditate scăzută</span></td>
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="card">
                <div class="header">
                    <h2>
                        DATE UMIDITATE - LINIA 2
                        <small>Tabelul conține înregistrări umidității solului de pe a 2-a linie de irigație.</small><br />
                    </h2>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th style="text-align:center;">Data</th>
                                <th style="text-align:center;">Valoare</th>
                                <th style="text-align:center;">Situație</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody2">
                            @foreach (var temp in sm2ValuesList)
                            {
                                <tr style="text-align:center;">
                                    <td>@temp.RegistrationDate</td>
                                    <td>@temp.Value %</td>
                                    @if (Decimal.Parse(temp.Value) > 85)
                                    {
                                        <td><span class="label label-danger">umiditate ridicată</span></td>
                                    }
                                    else if (Decimal.Parse(temp.Value) > 35 && Decimal.Parse(temp.Value) <= 85)
                                    {
                                        <td><span class="label label-warning">umiditate normală</span></td>
                                    }
                                    else if (Decimal.Parse(temp.Value) <= 35)
                                    {
                                        <td><span class="label label-success">umiditate scăzută</span></td>
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="card">
                <div class="header">
                    <h2>
                        DATE UMIDITATE - LINIA 3
                        <small>Tabelul conține înregistrări umidității solului de pe a 3-a linie de irigație.</small><br />
                    </h2>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th style="text-align:center;">Data</th>
                                <th style="text-align:center;">Valoare</th>
                                <th style="text-align:center;">Situație</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody3">
                            @foreach (var temp in sm3ValuesList)
                            {
                                <tr style="text-align:center;">
                                    <td>@temp.RegistrationDate</td>
                                    <td>@temp.Value %</td>
                                    @if (Decimal.Parse(temp.Value) > 85)
                                    {
                                        <td><span class="label label-danger">umiditate ridicată</span></td>
                                    }
                                    else if (Decimal.Parse(temp.Value) > 35 && Decimal.Parse(temp.Value) <= 85)
                                    {
                                        <td><span class="label label-warning">umiditate normală</span></td>
                                    }
                                    else if (Decimal.Parse(temp.Value) <= 35)
                                    {
                                        <td><span class="label label-success">umiditate scăzută</span></td>
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


<script type="text/javascript">


        function sendRequest() {
            $.ajax({
                url: '/Moisture/updateValues',
                type: 'POST',
                dataType: 'json',
                success: function (response) {
                    document.getElementById("soilMoisture1Div").innerHTML = response.soilMoisture1;
                    document.getElementById("soilMoisture2Div").innerHTML = response.soilMoisture2;
                    document.getElementById("soilMoisture3Div").innerHTML = response.soilMoisture3;

                    document.getElementById("tableBody1").innerHTML = "";
                    document.getElementById("tableBody2").innerHTML = "";
                    document.getElementById("tableBody3").innerHTML = "";

                    var rows1 = '';
                    var rows2 = '';
                    var rows3 = '';

                    $.each(response.sm1ValuesList, function (index, item) {
                        rows1 += '<tr style="text-align:center;"><td>' + item.RegistrationDate + '</td><td>' + item.Value + '</td>';
                        var _tempVal = parseFloat(item.Value);

                        if (_tempVal > 85) {
                            rows1 += '<td><span class="label label-danger">umiditate ridicată</span></td>';
                        } else if (_tempVal > 35 && _tempVal <= 85) {
                            rows1 += '<td><span class="label label-warning">umiditate normală</span></td>';
                        } else if (_tempVal <= 35) {
                            rows1 += '<td><span class="label label-success">umiditate scăzută</span></td>';
                        }

                        rows1 += '</tr>';
                    });
                    $('#tableBody1').html(rows1);

                    $.each(response.sm2ValuesList, function (index, item) {
                        rows2 += '<tr style="text-align:center;"><td>' + item.RegistrationDate + '</td><td>' + item.Value + '</td>';
                        var _tempVal = parseFloat(item.Value);

                        if (_tempVal > 85) {
                            rows2 += '<td><span class="label label-danger">umiditate ridicată</span></td>';
                        } else if (_tempVal > 35 && _tempVal <= 85) {
                            rows2 += '<td><span class="label label-warning">umiditate normală</span></td>';
                        } else if (_tempVal <= 35) {
                            rows2 += '<td><span class="label label-success">umiditate scăzută</span></td>';
                        }

                        rows2 += '</tr>';
                    });
                    $('#tableBody2').html(rows2);

                    $.each(response.sm3ValuesList, function (index, item) {
                        rows3 += '<tr style="text-align:center;"><td>' + item.RegistrationDate + '</td><td>' + item.Value + '</td>';
                        var _tempVal = parseFloat(item.Value);

                        if (_tempVal > 85) {
                            rows3 += '<td><span class="label label-danger">umiditate ridicată</span></td>';
                        } else if (_tempVal > 35 && _tempVal <= 85) {
                            rows3 += '<td><span class="label label-warning">umiditate normală</span></td>';
                        } else if (_tempVal <= 35) {
                            rows3 += '<td><span class="label label-success">umiditate scăzută</span></td>';
                        }

                        rows3 += '</tr>';
                    });
                    $('#tableBody3').html(rows3);



                  },
                complete: function () {
                    // Schedule the next request when the current one's complete
                     // The interval set to 5 seconds
                }
            });
        };

        setInterval(sendRequest, 5000);


</script>
